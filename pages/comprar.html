<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Comprar Ingresso</title>
    <link rel="stylesheet" href="../styles/home.css">
</head>
<body>

<main class="main">

    <h1 class="title">
        Comprar <span class="contrast">Ingresso</span>
    </h1>

    <form id="form-compra" class="form">

        <input type="hidden" name="lote_id" value="1">

        <label class="label" for="quantidade">Quantidade</label>
        <input
            type="number"
            id="quantidade"
            name="quantidade"
            class="input"
            value="1"
            min="1"
            required
        >

        <p class="text" id="valor_total"></p>

        <button type="submit" class="button">
            Pagar com Mercado Pago
        </button>
    </form>

    <div id="log" class="text" style="margin-top:15px;">
        Aguardando aÃ§Ã£o...
    </div>

</main>

<script>
    const PRECO_UNITARIO = 30.00;

    const qtdInput = document.getElementById('quantidade');
    const valorBox = document.getElementById('valor_total');
    const logBox   = document.getElementById('log');
    const form     = document.getElementById('form-compra');
    const button   = form.querySelector('button');

    function atualizarValor() {
        const qtd = Number(qtdInput.value);
        const total = qtd * PRECO_UNITARIO;
        valorBox.innerHTML = `Valor total: <b>R$ ${total.toFixed(2).replace('.', ',')}</b>`;
    }

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        button.disabled = true;
        logBox.innerText = 'Gerando pagamento...';

        const formData = new FormData(form);
        const data = new URLSearchParams(formData);

        try {
            const response = await fetch('../api/criar_pagamento.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: data
            });

            const result = await response.json();

            console.log(result);

            if (response.ok && result.status === 'ok' && result.link_pagamento) {
                window.location.href = result.link_pagamento;
            } else {
                logBox.innerText = 'Erro ao gerar pagamento: ' + (result.mensagem || 'Desconhecido');
                console.log(result.debug || result); // ðŸ‘ˆ mostra o debug
                button.disabled = false;
            }


sss
        } catch (err) {
            logBox.innerText = 'Erro de conexÃ£o com o servidor';
            button.disabled = false;
        }
    });

    atualizarValor();
    qtdInput.addEventListener('input', atualizarValor);
</script>

</body>
</html>
